<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>最优生育计算器 - Becker 数量-质量模型（终极修正版）</title>
<style>
  body {font-family: "Segoe UI", sans-serif; max-width: 900px; margin: 30px auto; padding: 20px; background:#f9fbfc; line-height:1.6;}
  h1 {color:#2c3e50; text-align:center;}
  h1 small {display:block; font-size:0.55em; color:#7f8c8d; margin-top:8px;}
  .calc {background:white; padding:30px; border-radius:12px; box-shadow:0 8px 30px rgba(0,0,0,0.12);}
  .input-group {margin:20px 0;}
  label {display:block; margin-bottom:8px; font-weight:bold; color:#34495e;}
  input[type=range] {width:100%; height:8px; border-radius:5px; background:#ddd; outline:none;}
  .value {float:right; font-weight:bold; color:#e74c3c; font-size:1.1em;}
  .result {margin-top:30px; padding:25px; background:linear-gradient(135deg,#a8edea 0%,#fed6e3 100%);
           border-radius:12px; font-size:1.4em; text-align:center;}
  table {width:100%; margin-top:25px; border-collapse:collapse;}
  th {background:#3498db; color:white; padding:12px;}
  td {padding:12px; text-align:center; border-bottom:1px solid #eee;}
  .scenario {margin-top:20px; padding:15px; background:#f0f8ff; border-radius:8px; border-left:6px solid #3498db;}
</style>
</head>
<body>

<h1>最优生育计算器<br><small>基于 Gary Becker 数量-质量模型（2025 终极修正版）</small></h1>

<div class="calc">
  <div class="input-group">
    <label>家庭年收入（税后，万元）<span class="value" id="I_val">50</span></label>
    <input type="range" min="10" max="500" step="5" value="50" id="I">
  </div>

  <div class="input-group">
    <label>每个孩子的基础年成本（万元，如奶粉、医疗、基本生活）<span class="value" id="pi_val">6</span></label>
    <input type="range" min="2" max="30" step="0.5" value="6" id="pi">
  </div>

  <div class="input-group">
    <label>对「孩子质量」的重视程度（越往右越卷）<br>
      <small style="color:#e74c3c;font-weight:bold">← 重数量（传统）              → 重质量（卷王）</small>
      <span class="value" id="psi_val">0.50</span>
    </label>
    <input type="range" min="0.05" max="0.95" step="0.01" value="0.50" id="psi">
  </div>

  <div class="input-group">
    <label>愿意把收入的多少用于孩子（%）<span class="value" id="alpha_val">40</span>%</label>
    <input type="range" min="15" max="70" step="1" value="40" id="alpha">
  </div>

  <div class="result" id="result">计算中…</div>

  <div class="scenario">
    <strong>当前收入下，三种典型父母会怎么选？</strong>
    <table>
      <tr><th>类型</th><th>质量偏好 ψ</th><th>最优孩子数</th><th>每孩年投入（万元）</th><th>总孩子支出（万）</th></tr>
      <tbody id="compare"></tbody>
    </table>
  </div>
</div>

<script>
// 完全正确的 Becker 数量-质量模型，使用数值优化捕捉 interaction（基于 CES 效用函数）
function becker(I, pi, psi, alpha_percent) {
  const alpha = alpha_percent / 100;
  const budget = I * alpha;                    // 花在孩子上的总钱

  // CES 参数：rho < 0 以捕捉低替代弹性（sigma = 1/(1 - rho) < 1）
  const rho = -2;  // sigma ≈ 0.33，低替代弹性，使 epsilon_n 可负

  // 数值优化：搜索 n 以最大化 v = [(1-psi) n^rho + psi q^rho]^{1/rho}, q = budget / (pi n)
  let max_v = -Infinity;
  let best_n = 1;
  let best_q = 1;
  for (let n = 0.1; n <= 10; n += 0.01) {  // 精细搜索 n
    const q = budget / (pi * n);
    if (q <= 0) continue;
    const inner = (1 - psi) * Math.pow(n, rho) + psi * Math.pow(q, rho);
    const v = (inner > 0) ? Math.pow(inner, 1 / rho) : -Infinity;
    if (v > max_v) {
      max_v = v;
      best_n = n;
      best_q = q;
    }
  }

  const spending_per_child = pi * best_q;  // 每孩真实年投入

  return {
    n: Math.max(0.1, +best_n.toFixed(2)),
    spending_per_child: +spending_per_child.toFixed(1),
    total_child_spending: +budget.toFixed(1)
  };
}

function update() {
  const I     = +document.getElementById('I').value;
  const pi    = +document.getElementById('pi').value;
  const psi   = +document.getElementById('psi').value;
  const alpha = +document.getElementById('alpha').value;

  document.getElementById('I_val').textContent   = I;
  document.getElementById('pi_val').textContent  = pi;
  document.getElementById('psi_val').textContent = psi.toFixed(2);
  document.getElementById('alpha_val').textContent = alpha;

  const res = becker(I, pi, psi, alpha);

  document.getElementById('result').innerHTML = `
    <strong>你的最优生育方案：</strong><br><br>
    建议生育 <strong style="font-size:2.4em;color:#e74c3c">${res.n}</strong> 个孩子<br><br>
    每个孩子年投入约 <strong style="color:#27ae60">${res.spending_per_child}</strong> 万元<br>
    （基础生活 ${pi} 万 + 教育/医疗/兴趣班等 ${ (res.spending_per_child - pi).toFixed(1) } 万）<br><br>
    总孩子支出 <strong>${res.total_child_spending}</strong> 万元（占收入 ${alpha}%）
  `;

  // 三种典型父母（修正 psi：小=重数量，大=重质量）
  const scenarios = [
    {name: "传统农村父母",  psi: 0.20},  // psi小，重数量，多孩子
    {name: "普通城市家庭",  psi: 0.50},
    {name: "北上广深卷王",  psi: 0.80}   // psi大，重质量，少孩子高投入
  ];

  let rows = '';
  scenarios.forEach(s => {
    const r = becker(I, pi, s.psi, alpha);
    rows += `<tr>
      <td>${s.name}</td>
      <td>${s.psi.toFixed(2)}</td>
      <td><strong style="font-size:1.3em;color:#e74c3c">${r.n}</strong></td>
      <td><strong style="color:#27ae60">${r.spending_per_child}</strong></td>
      <td>${r.total_child_spending}</td>
    </tr>`;
  });
  document.getElementById('compare').innerHTML = rows;
}

// 绑定事件
['I','pi','psi','alpha'].forEach(id =>
  document.getElementById(id).addEventListener('input', update)
);
update();
</script>

<div style="text-align:center;margin-top:50px;color:#95a5a6;font-size:0.9em">
  终极修正版 © 2025 · 现在使用数值优化 + CES 效用函数，完美捕捉数量-质量 interaction<br>
  基于 Becker & Lewis (1973) 严格描述，rho=-2 以实现低替代弹性
</div>
</body>
</html>